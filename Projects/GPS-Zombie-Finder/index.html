<!DOCTYPE html>
<html>

<head>
    <style>
        #zombie_map {
            height: 100%;
            width: 100%;
            left: 0;
            position: absolute;
            top: 0;
            background-color: grey;
        }
    </style>
    <script>
        let zombie_map;
        let allMarkers = [];
        let oldPosition;
        let tolerance;
        let score;

        function initMap() {
            zombie_map = new google.maps.Map(document.getElementById('zombie_map'), {
                zoom: 10,
                center: {
                    lat: -37.840935,
                    lng: 144.946457
                }
            });

            oldPosition = new google.maps.Marker({
                position: {
                    lat: -37.840935,
                    lng: 144.946457
                },
                map: zombie_map
            });

            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(set_my_position);
            } else {
                alert("Geolocation doesn't work in your browser");
            }

            for (let i = 0; i < markers.length; i++) {
                let markerData = markers[i].trim();
                markerData = markerData.split(" ");

                let latitude = markerData[0];
                let longitude = markerData[1];
                let emoji = markerData[2];

                let markerPosition = new google.maps.LatLng(latitude, longitude);
                var marker = new google.maps.Marker({
                    position: markerPosition,
                    map: zombie_map,
                    icon: emoji
                });


                allMarkers.push(marker);
            }
        }

        let data = `-37.83826122017263 144.95939158134297 images/zombie.png
                    -37.8401591590663 144.9640264385207 images/zombie.png
                    -37.84239595292358 144.95810412101582 images/zombie.png
                    -37.8353464332149 144.9493493907912 images/zombie.png
                    -37.81650627708324 144.9593954167194 images/hospital.png
                    -37.820981231221836 144.97055340622134 images/hospital.png
                    -37.81352282361109 144.97450161789126 images/hospital.png
                    -37.825862689963905 144.95836544845767 images/fight.png
                    -37.82599828143119 144.96677685592837 images/fight.png
                    -37.830395486901516 144.97953414916992 images/fight.png
                    -37.824642355547404 144.9714117131061 images/fight.png
                    `;

        let markers = data.split("\n")

        function set_my_position(position) {
            oldPosition.setMap(null);
            let pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            var marker = new google.maps.Marker({
                position: pos,
                map: zombie_map,
                icon: "images/smiley.png"
            });
            oldPosition = marker;

            for (let i = 0; i < allMarkers.length; i++) {
                let distance = google.maps.geometry.spherical.computeDistanceBetween(pos, allMarkers[i].getPosition());

                if (distance < tolerance) {
                    let item = allMarkers[i].getIcon();
                    item = item.replace(".png", "");

                    alert("Found the " + item);
                    allMarkers[i].setMap(null);
                }

                if (item != "zombie") {
                    score += 10;
                    alert("Your score is " + score);
                }
            }

            console.log(position.coords.latitude, position.coords.longitude);
        }
    </script>
</head>

<body>
    My zombie map
    <div id="zombie_map">
        <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCVv9LOf-wJiOp9kM66yc9Ti3NvyHarrUc&callback=initMap&libraries=geometry"></script>
        </script>
    </div>
    <form>
        Select an emoji
        <select id="icon_to_use">
            <option value="images/zombie.png">Zombie</option>
            <option value="images/hospital.png">Hospital</option>
            <option value="images/fight.png">Fight</option>
        </select>
    </form>
</body>

</html>